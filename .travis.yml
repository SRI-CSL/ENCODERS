dist: xenial
sudo: required

language: c++

compiler:
  - g++

#dependencies
install:
#  - sudo apt-get install gcc-4.9
#  - sudo apt-get install g++-4.9
#  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 49 --slave /usr/bin/g++ g++ /usr/bin/g++-4.9
#  - sudo update-alternatives --set gcc "/usr/bin/gcc-4.9"
  - export ENCODERS_HOME=`pwd`
  - cd ${ENCODERS_HOME}/haggle && ./dependencies_ubuntu.sh
  - export COVERALLS_REPO_TOKEN="qB3LrhoMhX0VajBpJ07kQ0ThWlSf1cWko"
  - export CXXFLAGS="${CXXFLAGS} -fprofile-arcs -ftest-coverage"
  - sudo pip install --user cpp-coveralls;
  - sudo pip install pyyaml;
  - export PATH=$PATH:${HOME}/.local/bin

script:
  - cd ${ENCODERS_HOME}/haggle 
  - ./build_ubuntu.sh
  
after_script:
  - coveralls -r .. -b testsuite/test_thread -i haggle/src --verbose --gcov-options '\-lp';
